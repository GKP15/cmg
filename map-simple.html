

<!DOCTYPE html>
<html>
  <head>
<script>
/* Mein API KEY */
var API_KEY = AIzaSyD-L9S94qy4G_3zEeTY_r-NOzfAv1P74z8;
</script>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>DIY G00GL3MAP</title>
	<style>
	      	html, body, 
		#map-canvas {
			height: 100%;
			margin: 0px;
			padding: 0px
	      	}
	      	#panel {
			position: absolute;
			top: 5px;
			left: 50%;
			margin-left: -180px;
			z-index: 5;
			background-color: #fff;
			padding: 5px;
			border: 1px solid #999;
	      	}
    	</style>

    <script src="https://maps.googleapis.com/maps/api/js?key=" + API_KEY></script>
    <script>
var geocoder;
var map;
var infoWindow;
var mapDiv; 

//speichert pacman daten
var pacmanIcon;

var pacmanIconLeft;
var pacmanIconRight;
var pacmanIconUp;
var pacmanIconDown;
var pacmanIconClose;

var pacman

var open;
//speichert die daten für den Geist
var ghostIcon;
var ghost;


//speichert den Zoomfaktor
var zoom;


//Die Schrittweite auf der Karte		
		
//Leipzig Halle
//var step = 0.01;
		
//Leipzig Innenstadt
var step = 0.0001;

//eine Variable die die neue Position vom Geist speichert
var newPosition;

//eine Variable für die Tatstatureingabe
var key;

//Gameloop
//frame
var ONE_FRAME_TIME = 1000 / 1 ;
    

var mainloop = function() {	
        updateGame();
        drawGame();
    };


setInterval( mainloop, ONE_FRAME_TIME );

function updateGame() {
	goPacman(key);
	
}

function drawGame() {
	//pacman.setMap(null);
	
	pacman.setPosition(newPosition);
		
	pacman.setMap(map);
}

function goPacman(key) {
	if (pacman == null) {
		pacman = new google.maps.Marker({
	    		position: map.getCenter(),
	    		map: map,
	    		title: 'HERO',
			icon: pacmanIconRight,
			draggable: true
	  	});
		open = true;
	} 
	//welche Taste wurde gedrückt?		
		var pressedKey = key.keyCode; 


		//jenachdem was gedrueckt wurde die neuen koordinaten setzen
		switch (pressedKey) {
    			case 97: //left        			
				moveLeft(pacman);       			
				break;
    			case 100: //right
				moveRight(pacman);
				break;
			case 119: //up
				moveUp(pacman);
				break;
    			case 115: //down
				moveDown(pacman);
				break;  
			default: //was anderes gedrückt
				key = null;
				//newPosition = pacman.getPosition();
				break;
		}
		
}



//bewegung nach links
function moveLeft(player){
		newPosition = new google.maps.LatLng(player.getPosition().lat(), player.getPosition().lng() - step);
		if (open) {
			pacman.setIcon(pacmanIconClose);
			open = false;
		} else {
			pacman.setIcon(pacmanIconLeft);
			open = true;
		}
}

function moveRight(player){
		newPosition = new google.maps.LatLng(player.getPosition().lat(), player.getPosition().lng() + step);
		if (open) {
			pacman.setIcon(pacmanIconClose);
			open = false;
		} else {
			pacman.setIcon(pacmanIconRight);
			open = true;
		}
}

function moveUp(player){
		newPosition = new google.maps.LatLng(player.getPosition().lat() + step, player.getPosition().lng());
		if (open) {
			pacman.setIcon(pacmanIconClose);
			open = false;
		} else {
			pacman.setIcon(pacmanIconUp);
			open = true;
		}
}

function moveDown(player){
		newPosition = new google.maps.LatLng(player.getPosition().lat() - step, player.getPosition().lng());
		if (open) {
			pacman.setIcon(pacmanIconClose);
			open = false;
		} else {
			pacman.setIcon(pacmanIconDown);
			open = true;
		}
}



function initialize() {
	geocoder = new google.maps.Geocoder();
	
	// Define an info window on the map.
	infoWindow = new google.maps.InfoWindow();
	zoom = 8;

	var latlng = new google.maps.LatLng(51.339852, 12.368916);
	var mapOptions = {
		zoom: zoom,
		center: latlng
	}
	mapDiv = document.getElementById('map-canvas');
	map = new google.maps.Map(mapDiv, mapOptions);
	
	
	

	pacmanIconLeft = {
	    		url: "pacman_open_left.png", // url
	    		scaledSize: new google.maps.Size(35, 35), // scaled size
	    		origin: new google.maps.Point(0,0), // origin
	    		anchor: new google.maps.Point(0, 0) // anchor
		};

	pacmanIconRight = {
	    		url: "pacman_open_right.png", // url
	    		scaledSize: new google.maps.Size(35, 35), // scaled size
	    		origin: new google.maps.Point(0,0), // origin
	    		anchor: new google.maps.Point(0, 0) // anchor
		};
	
	pacmanIconUp = {
	    		url: "pacman_open_up.png", // url
	    		scaledSize: new google.maps.Size(35, 35), // scaled size
	    		origin: new google.maps.Point(0,0), // origin
	    		anchor: new google.maps.Point(0, 0) // anchor
		};

	pacmanIconDown = {
	    		url: "pacman_open_down.png", // url
	    		scaledSize: new google.maps.Size(35, 35), // scaled size
	    		origin: new google.maps.Point(0,0), // origin
	    		anchor: new google.maps.Point(0, 0) // anchor
		};

	pacmanIconClose = {
	    		url: "pacman_close.png", // url
	    		scaledSize: new google.maps.Size(35, 35), // scaled size
	    		origin: new google.maps.Point(0,0), // origin
	    		anchor: new google.maps.Point(0, 0) // anchor
		};


	/*
	*	Event Listener dass beim clicken ein pacmansymbol auf der karte erscheint.
	*
	*/
		
	/*google.maps.event.addListener(map, "click", function(event) {
    		var lat = event.latLng.lat();
    		var lng = event.latLng.lng();
    	
		
	  	
		var pacmanII = new google.maps.Marker({
	    		position: event.latLng,
	    		map: map,
	    		title: lat + ' ' + lng,
			icon: pacmanIcon
	  	});
		
	});
	*/
	ghostIcon = {
    		url: "ghost.png", // url
    		scaledSize: new google.maps.Size(35, 35), // scaled size
    		origin: new google.maps.Point(0,0), // origin
    		anchor: new google.maps.Point(0, 0) // anchor
	};

	// Setzt ein Info Window am Startpunkt
	infoWindow.setContent("Suche erstmal einen Ort <br> an dem du Spielen willst <br> in dem Suchfenster");
	//infoWindow.setPosition(home);
	infoWindow.setPosition(map.getCenter());		
	infoWindow.open(map);

	mainloop();
	
	
		
}
function resetPlayer(player) {
	player.setMap(null);
	player.setPosition(map.getCenter());
	player.setMap(map);
}





function codeAddress() {
	
	//speichert die Geodaten des Eingebenen Ortes	
	var home;
	
	var address = document.getElementById('address').value;
	geocoder.geocode( { 'address': address}, function(results, status) {
		if (status == google.maps.GeocoderStatus.OK) {

			map.setCenter(results[0].geometry.location);
			//setzt den Zoomfaktor nach der Eingabe eines Ortes			
			zoom = 18;			
			map.setZoom(zoom);

			//speichert die geodaten des ergebnisses in die variable home
			home = google.maps.LatLng(results[0].geometry.location);

						
			// Set the info window's content and position.
			infoWindow.setContent("Wenn du eine beliebige Taste drückst, <br> kannst den Geist mit awds steuern.");
			//infoWindow.setPosition(home);
			infoWindow.setPosition(map.getCenter());
			
			infoWindow.open(map);
			
		} else {
			alert('Geocode was not successful for the following reason: ' + status);
		}
		
		//google.maps.event.addDomListener(document, 'keypress', goGhost);
	});
	
	


}

google.maps.event.addDomListener(window, 'load', initialize);
google.maps.event.addDomListener(document, 'keypress', function(pressedKey){
		key = pressedKey;
		} );
    </script>
  </head>
  <body>
    <div id="panel">
      <input id="address" type="textbox" value="Ort Eingeben">
      <input type="button" value="Reset Ghost." onclick="resetPlayer(pacman);key = null"> 
     <! <input type="button" value="Go!!!" onclick="codeAddress();window.location.hash='map-canvas';">
      <input type="button" value="Go!!!" onclick="codeAddress();">
	
    </div>
    <div id="map-canvas"></div>
  </body>
</html>


